# üíª –ü—Ä–∏–º–µ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞ –¥–ª—è email-–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏

## üìç –§–∞–π–ª –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è

```
/supabase/functions/server/index.tsx
```

---

## ‚úèÔ∏è –ß—Ç–æ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å

### –ù–∞–π–¥–∏—Ç–µ endpoint `/signup` (—Å—Ç—Ä–æ–∫–∞ ~42)

```typescript
app.post('/make-server-05bdbe69/signup', async (c) => {
```

### –ù–∞–π–¥–∏—Ç–µ –±–ª–æ–∫ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å—Ç—Ä–æ–∫–∏ ~62-71)

---

## ‚ùå –ë–´–õ–û (—Å –∞–≤—Ç–æ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º)

```typescript
// –°–æ–∑–¥–∞—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const { data, error } = await supabase.auth.admin.createUser({
  email,
  password,
  user_metadata: { 
    name: name || email.split('@')[0],
    role: userRole,
  },
  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º email, —Ç–∞–∫ –∫–∞–∫ —Å–µ—Ä–≤–µ—Ä email –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
  email_confirm: true,  // ‚Üê –≠–¢–£ –°–¢–†–û–ö–£ –ù–£–ñ–ù–û –£–î–ê–õ–ò–¢–¨!
});
```

---

## ‚úÖ –°–¢–ê–õ–û (—Å email-–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–µ–π)

```typescript
// –°–æ–∑–¥–∞—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const { data, error } = await supabase.auth.admin.createUser({
  email,
  password,
  user_metadata: { 
    name: name || email.split('@')[0],
    role: userRole,
  },
  // Email –±—É–¥–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞ –ø–æ —Å—Å—ã–ª–∫–µ –≤ –ø–∏—Å—å–º–µ
});
```

---

## üîÑ –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç–µ–∫—Å—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è

–í–æ—Ç –∫–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç –≤–µ—Å—å endpoint –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

```typescript
app.post('/make-server-05bdbe69/signup', async (c) => {
  try {
    const { email, password, name } = await c.req.json();

    if (!email || !password) {
      return c.json({ error: 'Email and password are required' }, 400);
    }

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
    const { data: { users: existingUsers }, error: listError } = await supabase.auth.admin.listUsers();
    
    if (listError) {
      console.error('Error checking existing users:', listError);
    }

    // –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - –¥–µ–ª–∞–µ–º –µ–≥–æ –∞–¥–º–∏–Ω–æ–º
    const isFirstUser = !existingUsers || existingUsers.length === 0;
    const userRole = isFirstUser ? 'admin' : 'user';

    // –°–æ–∑–¥–∞—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    const { data, error } = await supabase.auth.admin.createUser({
      email,
      password,
      user_metadata: { 
        name: name || email.split('@')[0],
        role: userRole,
      },
      // Email –±—É–¥–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞ –ø–æ —Å—Å—ã–ª–∫–µ –≤ –ø–∏—Å—å–º–µ
    });

    if (error) {
      console.error('Signup error:', error);
      return c.json({ error: error.message }, 400);
    }

    if (isFirstUser) {
      console.log(`üéâ –ü–µ—Ä–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ ADMIN: ${email}`);
    } else {
      console.log(`‚úÖ –ù–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω: ${email}`);
    }

    return c.json({ 
      user: data.user,
      message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ email –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.'
    });
  } catch (err) {
    console.error('Unexpected signup error:', err);
    return c.json({ error: 'Internal server error' }, 500);
  }
});
```

---

## üìù –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å?

### 1. –£–¥–∞–ª–µ–Ω–∞ —Å—Ç—Ä–æ–∫–∞
```typescript
email_confirm: true,  // ‚Üê –£–¥–∞–ª–∏–ª–∏
```

### 2. –ò–∑–º–µ–Ω—ë–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
**–ë—ã–ª–æ:**
```typescript
// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º email, —Ç–∞–∫ –∫–∞–∫ —Å–µ—Ä–≤–µ—Ä email –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
```

**–°—Ç–∞–ª–æ:**
```typescript
// Email –±—É–¥–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω –ø–æ—Å–ª–µ –∫–ª–∏–∫–∞ –ø–æ —Å—Å—ã–ª–∫–µ –≤ –ø–∏—Å—å–º–µ
```

### 3. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –ò–∑–º–µ–Ω—ë–Ω –æ—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞
**–ë—ã–ª–æ:**
```typescript
return c.json({ user: data.user });
```

**–°—Ç–∞–ª–æ:**
```typescript
return c.json({ 
  user: data.user,
  message: '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ email –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.'
});
```

---

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç

### 1. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª
```
Ctrl+S
```

### 2. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
```bash
# –ï—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
supabase functions serve
```

### 3. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ó–∞–ø—Ä–æ—Å:**
```typescript
const response = await fetch(`https://${projectId}.supabase.co/functions/v1/make-server-05bdbe69/signup`, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': `Bearer ${publicAnonKey}`,
  },
  body: JSON.stringify({
    email: 'test@example.com',
    password: 'TestPassword123',
    name: 'Test User'
  })
});
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```json
{
  "user": { ... },
  "message": "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–æ–∑–¥–∞–Ω. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ email –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è."
}
```

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Supabase Dashboard

```
Authentication ‚Üí Users ‚Üí [–ù–∞–π–¥–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è]
```

**Email Confirmed –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:**
- ‚ùå **No** (–∫—Ä–∞—Å–Ω—ã–π –∫—Ä–µ—Å—Ç–∏–∫) ‚Äî –ø–æ–∫–∞ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω
- –ü–æ—Å–ª–µ –∫–ª–∏–∫–∞ –ø–æ —Å—Å—ã–ª–∫–µ –≤ –ø–∏—Å—å–º–µ ‚Üí ‚úÖ **Yes** (–∑–µ–ª–µ–Ω–∞—è –≥–∞–ª–æ—á–∫–∞)

---

## üö® –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### ‚ö†Ô∏è –ü–µ—Ä–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—Å—ë –µ—â—ë —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–¥–º–∏–Ω–æ–º

–≠—Ç–æ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ! –ü–µ—Ä–≤—ã–π –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç —Ä–æ–ª—å `admin` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –Ω–æ **–≤—Å—ë —Ä–∞–≤–Ω–æ –¥–æ–ª–∂–µ–Ω –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å email**.

```typescript
const isFirstUser = !existingUsers || existingUsers.length === 0;
const userRole = isFirstUser ? 'admin' : 'user';  // ‚Üê –≠—Ç–æ –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è!
```

### ‚ö†Ô∏è –ù–µ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –º–æ–≥—É—Ç –≤–æ–π—Ç–∏

–ü–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è `email_confirm: true`, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ **–Ω–µ —Å–º–æ–≥—É—Ç –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É** –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–¥—è—Ç email.

**–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ!** –≠—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.

### ‚ö†Ô∏è –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å

–°–æ–≥–ª–∞—Å–Ω–æ –≤–∞—à–µ–º—É `Guidelines.md`:
> –í–ê–ñ–ù–û! –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ, —Ä–µ–∞–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å–µ–π—á–∞—Å –Ω–µ—Ç. –ü–æ—ç—Ç–æ–º—É –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å–µ–π—á–∞—Å –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

–≠—Ç–æ –∑–Ω–∞—á–∏—Ç, —á—Ç–æ —Å—Ç–∞—Ä—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å `email_confirm: true` –±—É–¥—É—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–æ—Ä–º–∞–ª—å–Ω–æ.

---

## üîÑ –ö–∞–∫ –æ—Ç–∫–∞—Ç–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –ø—Ä–æ—Å—Ç–æ –≤–µ—Ä–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫—É –æ–±—Ä–∞—Ç–Ω–æ:

```typescript
const { data, error } = await supabase.auth.admin.createUser({
  email,
  password,
  user_metadata: { 
    name: name || email.split('@')[0],
    role: userRole,
  },
  email_confirm: true,  // ‚Üê –í–µ—Ä–Ω—É–ª–∏ –æ–±—Ä–∞—Ç–Ω–æ
});
```

–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —Ñ–∞–π–ª ‚Äî –∏ –≤—Å—ë –≤–µ—Ä–Ω—ë—Ç—Å—è –∫–∞–∫ –±—ã–ª–æ.

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ: –î–æ –∏ –ü–æ—Å–ª–µ

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –î–æ (–∞–≤—Ç–æ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ) | –ü–æ—Å–ª–µ (email-–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è) |
|----------|----------------------|--------------------------|
| **email_confirm** | `true` | `false` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) |
| **–ü–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è?** | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ |
| **Email Confirmed —Å—Ä–∞–∑—É?** | ‚úÖ –î–∞ | ‚ùå –ù–µ—Ç (—Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è) |
| **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏?** | ‚úÖ –°—Ä–∞–∑—É | ‚ùå –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è email |
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** | –ù–∏–∑–∫–∞—è | –í—ã—Å–æ–∫–∞—è |
| **UX** | –ë—ã—Å—Ç—Ä–æ, –Ω–æ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ | –ú–µ–¥–ª–µ–Ω–Ω–µ–µ, –Ω–æ –Ω–∞–¥—ë–∂–Ω–æ |

---

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è:

1. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—É–¥—É—Ç –ø–æ–ª—É—á–∞—Ç—å –ø–∏—Å—å–º–æ —Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º
2. ‚úÖ –ë—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤–∞—à–∏ –∫—Ä–∞—Å–∏–≤—ã–µ email-—à–∞–±–ª–æ–Ω—ã
3. ‚úÖ Email –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω –ø–µ—Ä–µ–¥ –≤—Ö–æ–¥–æ–º
4. ‚úÖ –ü–æ–≤—ã—à–∞–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

**–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:** –ó–∞–≥—Ä—É–∑–∏—Ç–µ email-—à–∞–±–ª–æ–Ω—ã –≤ Supabase Dashboard (—Å–º. `SETUP-GUIDE.md`)
