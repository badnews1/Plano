/**
 * –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç Area Chart
 * 
 * –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–π –∑–∞–ª–∏–≤–∫–æ–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
 * –ª—é–±—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –≤–∏–¥–µ Area Chart. –ü–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–π –∏
 * –Ω–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –ø—Ä–µ–¥–º–µ—Ç–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏.
 * 
 * @updated 18 –¥–µ–∫–∞–±—Ä—è 2025 - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —ç–ª–µ–º–µ–Ω—Ç–∞–º –º–∞—Å—Å–∏–≤–∞ (noUncheckedIndexedAccess —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å)
 */

import { ResponsiveContainer, AreaChart as RechartsAreaChart, Area, XAxis, YAxis, Tooltip } from 'recharts';

export interface AreaChartDataPoint {
  /** –ú–µ—Ç–∫–∞ –¥–ª—è –æ—Å–∏ X (–¥–µ–Ω—å, –¥–∞—Ç–∞ –∏ —Ç.–¥.) */
  label: string | number;
  /** –ó–Ω–∞—á–µ–Ω–∏–µ –¥–ª—è –æ—Å–∏ Y */
  value: number;
  /** –§–ª–∞–≥ —Ñ–∏–∫—Ç–∏–≤–Ω–æ–π —Ç–æ—á–∫–∏ (–¥–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è tooltip) */
  isPadding?: boolean;
}

export interface AreaChartProps {
  /** –î–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è */
  data: AreaChartDataPoint[];
  /** –í—ã—Å–æ—Ç–∞ –≥—Ä–∞—Ñ–∏–∫–∞ –≤ –ø–∏–∫—Å–µ–ª—è—Ö */
  height?: number;
  /** –¶–≤–µ—Ç –ª–∏–Ω–∏–∏ –∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ (hex) */
  color?: string;
  /** –ù–∞–∑–≤–∞–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è tooltip */
  valueLabel?: string;
  /** –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª–∏ tooltip –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
  showTooltip?: boolean;
  /** –î–æ–±–∞–≤–ª—è—Ç—å –ª–∏ —Ñ–∏–∫—Ç–∏–≤–Ω—ã–µ —Ç–æ—á–∫–∏ –ø–æ –∫—Ä–∞—è–º –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è */
  addPaddingPoints?: boolean;
  /** ID –¥–ª—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ) */
  gradientId?: string;
  /** –¢–æ–ª—â–∏–Ω–∞ –ª–∏–Ω–∏–∏ */
  strokeWidth?: number;
  /** –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –∑–∞–ª–∏–≤–∫–∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ (0-1) */
  fillOpacity?: number;
  /** –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ CSS –∫–ª–∞—Å—Å—ã –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
  className?: string;
  /** –ö–∞—Å—Ç–æ–º–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏—è –≤ tooltip */
  tooltipFormatter?: (value: number) => [string, string];
  /** –ö–∞—Å—Ç–æ–º–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä –¥–ª—è –º–µ—Ç–∫–∏ –≤ tooltip */
  labelFormatter?: (label: string | number) => string;
}

/**
 * Area Chart —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–π –∑–∞–ª–∏–≤–∫–æ–π
 * 
 * –†–µ–Ω–¥–µ—Ä–∏—Ç –∫—Ä–∞—Å–∏–≤—ã–π –≥—Ä–∞—Ñ–∏–∫ —Å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏.
 * –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ª—é–±—ã—Ö –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä—è–¥–æ–≤ –∏–ª–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–µ–π –¥–∞–Ω–Ω—ã—Ö.
 * 
 * @example
 * ```tsx
 * <AreaChart
 *   data={[
 *     { label: 1, value: 5 },
 *     { label: 2, value: 8 },
 *     { label: 3, value: 6 },
 *   ]}
 *   height={200}
 *   color="#3b82f6"
 *   valueLabel="–í—ã–ø–æ–ª–Ω–µ–Ω–æ"
 * />
 * ```
 */
export function AreaChart({
  data, // –ú–∞—Å—Å–∏–≤ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞
  height = 200, // –í—ã—Å–æ—Ç–∞ –≥—Ä–∞—Ñ–∏–∫–∞ –≤ –ø–∏–∫—Å–µ–ª—è—Ö (default: 200)
  color = 'var(--accent-primary-indigo)', // –¶–≤–µ—Ç –ª–∏–Ω–∏–∏ –∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ (default: --accent-primary-indigo)
  valueLabel = '–ó–Ω–∞—á–µ–Ω–∏–µ', // –ù–∞–∑–≤–∞–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ tooltip (default: '–ó–Ω–∞—á–µ–Ω–∏–µ')
  showTooltip = true, // –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å –ª–∏ tooltip –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ (default: true)
  addPaddingPoints = true, // –î–æ–±–∞–≤–ª—è—Ç—å –ª–∏ —Ñ–∏–∫—Ç–∏–≤–Ω—ã–µ —Ç–æ—á–∫–∏ –ø–æ –∫—Ä–∞—è–º –¥–ª—è –ø–ª–∞–≤–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (default: true)
  gradientId = 'areaChartGradient', // –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –¥–ª—è –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ (–Ω—É–∂–µ–Ω –µ—Å–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–æ –≥—Ä–∞—Ñ–∏–∫–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ) (default: 'areaChartGradient')
  strokeWidth = 2, // –¢–æ–ª—â–∏–Ω–∞ –ª–∏–Ω–∏–∏ –≥—Ä–∞—Ñ–∏–∫–∞ –≤ –ø–∏–∫—Å–µ–ª—è—Ö (default: 2)
  fillOpacity = 1, // –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –∑–∞–ª–∏–≤–∫–∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ –æ—Ç 0 –¥–æ 1 (default: 1)
  className, // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ CSS –∫–ª–∞—Å—Å—ã –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
  tooltipFormatter, // –ö–∞—Å—Ç–æ–º–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏—è –≤ tooltip
  labelFormatter, // –ö–∞—Å—Ç–æ–º–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç—Ç–µ—Ä –¥–ª—è –º–µ—Ç–∫–∏ –≤ tooltip
}: AreaChartProps) {
  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö: –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ñ–∏–∫—Ç–∏–≤–Ω—ã—Ö —Ç–æ—á–µ–∫ –ø–æ –∫—Ä–∞—è–º –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
  // –≠—Ç–æ –¥–µ–ª–∞–µ—Ç—Å—è –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –≥—Ä–∞—Ñ–∏–∫ –Ω–∞—á–∏–Ω–∞–ª—Å—è –∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞–ª—Å—è –ø–ª–∞–≤–Ω–æ,
  // –∞ –Ω–µ –æ–±—Ä–µ–∑–∞–ª—Å—è –Ω–∞ –ø–µ—Ä–≤–æ–π –∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ç–æ—á–∫–µ
  const chartData = (() => {
    // –ï—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω—ã –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏ –∏–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫–∞–∫ –µ—Å—Ç—å
    if (!addPaddingPoints || data.length === 0) {
      return data;
    }

    // üî• –ë–ï–ó–û–ü–ê–°–ù–´–ô –î–û–°–¢–£–ü: –ø—Ä–æ–≤–µ—Ä—è–µ–º —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
    const firstItem = data[0];
    const lastItem = data[data.length - 1];

    // –ï—Å–ª–∏ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∫–∞–∫ –µ—Å—Ç—å
    if (!firstItem || !lastItem) {
      return data;
    }

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–µ—Ç–∫–∏ –¥–ª—è –ø–µ—Ä–≤–æ–π –∏ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ç–æ—á–∫–∏
    const firstLabel = typeof firstItem.label === 'number' ? firstItem.label : 0;
    const lastLabel = typeof lastItem.label === 'number' 
      ? lastItem.label 
      : data.length;

    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å –¥–æ–±–∞–≤–ª–µ–Ω–Ω—ã–º–∏ —Ç–æ—á–∫–∞–º–∏ –ø–æ –∫—Ä–∞—è–º
    return [
      { 
        label: typeof firstLabel === 'number' ? firstLabel - 1 : 0, 
        value: firstItem.value, // –ó–Ω–∞—á–µ–Ω–∏–µ —Ç–∞–∫–æ–µ –∂–µ –∫–∞–∫ —É –ø–µ—Ä–≤–æ–π —Ç–æ—á–∫–∏
        isPadding: true, // –§–ª–∞–≥ —Ñ–∏–∫—Ç–∏–≤–Ω–æ–π —Ç–æ—á–∫–∏
      },
      ...data, // –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
      { 
        label: typeof lastLabel === 'number' ? lastLabel + 1 : data.length + 1, 
        value: lastItem.value, // –ó–Ω–∞—á–µ–Ω–∏–µ —Ç–∞–∫–æ–µ –∂–µ –∫–∞–∫ —É –ø–æ—Å–ª–µ–¥–Ω–µ–π —Ç–æ—á–∫–∏
        isPadding: true, // –§–ª–∞–≥ —Ñ–∏–∫—Ç–∏–≤–Ω–æ–π —Ç–æ—á–∫–∏
      },
    ];
  })();

  return (
    <div 
      style={{ 
        height: `${height}px`, // –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞
        minHeight: `${height}px`, // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –≤—ã—Å–æ—Ç–∞ (–¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è —Å—Ö–ª–æ–ø—ã–≤–∞–Ω–∏—è)
        minWidth: '200px', // –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ (–¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è)
        overflow: 'visible', // –†–∞–∑—Ä–µ—à–∞–µ–º –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏–µ (–≥—Ä–∞—Ñ–∏–∫ –º–æ–∂–µ—Ç –≤—ã—Ö–æ–¥–∏—Ç—å –∑–∞ –≥—Ä–∞–Ω–∏—Ü—ã)
      }}
      className={className}
    >
      {/* ResponsiveContainer –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç –≥—Ä–∞—Ñ–∏–∫ –ø–æ–¥ —à–∏—Ä–∏–Ω—É —Ä–æ–¥–∏—Ç–µ–ª—è */}
      <ResponsiveContainer width="100%" height={height} minHeight={height}>
        <RechartsAreaChart
          data={chartData}
          margin={{ top: 10, right: 0, left: 0, bottom: 0 }} // –î–æ–±–∞–≤–ª—è–µ–º –æ—Ç—Å—Ç—É–ø —Å–≤–µ—Ä—Ö—É –¥–ª—è overflow
        >
          {/* –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞ –¥–ª—è –∑–∞–ª–∏–≤–∫–∏ –æ–±–ª–∞—Å—Ç–∏ –ø–æ–¥ –≥—Ä–∞—Ñ–∏–∫–æ–º */}
          <defs>
            <linearGradient id={gradientId} x1="0" y1="0" x2="0" y2="1">
              <stop offset="5%" stopColor={color} stopOpacity={0.2} /> {/* –í–µ—Ä—Ö: 20% –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏ */}
              <stop offset="95%" stopColor={color} stopOpacity={0} /> {/* –ù–∏–∑: –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ–∑—Ä–∞—á–Ω—ã–π */}
            </linearGradient>
          </defs>
          
          {/* –û—Å—å X (—Å–∫—Ä—ã—Ç–∞—è, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ—á–µ–∫) */}
          <XAxis 
            dataKey="label" 
            hide={true}
            type="category"
          />
          
          {/* –û—Å—å Y (—Å–∫—Ä—ã—Ç–∞—è, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π) */}
          <YAxis hide={true} />
          
          {/* Tooltip –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –≥—Ä–∞—Ñ–∏–∫ */}
          {showTooltip && (
            <Tooltip
              content={(props) => {
                // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º tooltip –¥–ª—è —Ñ–∏–∫—Ç–∏–≤–Ω—ã—Ö —Ç–æ—á–µ–∫
                if (props.payload?.[0]?.payload?.isPadding) {
                  return null;
                }
                
                // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π tooltip –¥–ª—è –æ–±—ã—á–Ω—ã—Ö —Ç–æ—á–µ–∫
                const { active, payload, label } = props;
                if (!active || !payload || payload.length === 0) return null;

                return (
                  <div
                    style={{
                      backgroundColor: 'var(--bg-primary)',
                      border: '1px solid var(--border-secondary)',
                      borderRadius: '8px',
                      fontSize: 'var(--text-xs)', // 11-12px
                      padding: '6px 8px',
                    }}
                  >
                    <div
                      style={{
                        color: 'var(--text-primary)',
                        fontWeight: 600,
                        marginBottom: '2px',
                        fontSize: 'var(--text-xs)', // 12px –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ (–¥–∞—Ç—ã)
                      }}
                    >
                      {labelFormatter ? labelFormatter(label) : label}
                    </div>
                    {payload.map((entry, index) => (
                      <div
                        key={`item-${index}`}
                        style={{
                          padding: '2px 0',
                          lineHeight: '1.2',
                          color: 'var(--text-secondary)',
                        }}
                      >
                        {tooltipFormatter
                          ? tooltipFormatter(entry.value as number)[0]
                          : `${entry.name}: ${entry.value}`}
                      </div>
                    ))}
                  </div>
                );
              }}
            />
          )}
          
          {/* –°–∞–º–∞ –æ–±–ª–∞—Å—Ç—å –≥—Ä–∞—Ñ–∏–∫–∞ —Å –ª–∏–Ω–∏–µ–π –∏ –∑–∞–ª–∏–≤–∫–æ–π */}
          <Area
            type="monotone" // –ü–ª–∞–≤–Ω–∞—è –∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è –º–µ–∂–¥—É —Ç–æ—á–∫–∞–º–∏
            dataKey="value" // –ö–ª—é—á –¥–ª—è –∑–Ω–∞—á–µ–Ω–∏–π –ø–æ –æ—Å–∏ Y
            stroke={color} // –¶–≤–µ—Ç –ª–∏–Ω–∏–∏
            strokeWidth={strokeWidth} // –¢–æ–ª—â–∏–Ω–∞ –ª–∏–Ω–∏–∏
            fillOpacity={fillOpacity} // –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å –∑–∞–ª–∏–≤–∫–∏
            fill={`url(#${gradientId})`} // –°—Å—ã–ª–∫–∞ –Ω–∞ –≥—Ä–∞–¥–∏–µ–Ω—Ç
            name={valueLabel} // –ù–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è tooltip
          />
        </RechartsAreaChart>
      </ResponsiveContainer>
    </div>
  );
}